<!DOCTYPE html>
<html lang="es">
<head>
<!-- Script del programa processing, necesario para que funcione la demo -->
<script type="text/javascript" src="../js/processing.min.js"></script> 
     <!-- jQuery from CDN -->
<script src="../js/jquery.min.js"></script>



      <script src="../js/jribbble.js"></script>
      <script src="../js/bootstrap.js"></script>
</script>
      
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    
    <title>Portfolio</title>
    
    <!-- Bootstrap + Font Awesome + Main CSS -->
    <link href="../css/font-awesome.css" rel="stylesheet">
    <link href="../css/bootstrap.css" rel="stylesheet">
    <!-- customize this file if needed -->
    <link href="../css/main.css" rel="stylesheet">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
</head>

<body>
    <div class="wrapper">
        <div class="container">
            <header>
                <div class="row">
                    <div class="navbar">
                        <div class="navbar-header">
                            <button class="navbar-toggle collapsed" data-target=".navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="https://emiliomm.github.io">PORTFOLIO</a>
                        </div>

                        <div class="collapse navbar-collapse">
                            <ul class="nav navbar-nav">
                                <li>
                                    <a href="https://emiliomm.github.io">Inicio</a>
                                </li>
                            </ul>

                            <ul class="nav navbar-nav social">
                                      <li><a href="https://www.facebook.com/emilio.montejanomora"> <i class="fa fa-facebook"></i> </a></li>
                                      <li><a href="https://github.com/emiliomm/"> <i class="fa fa-github"></i> </a> </li>  
                            </ul>
                        </div><!-- /.nav-collapse -->
                    </div><!-- /.navbar -->
                </div>

                <div class="row">
                    <div class="col-md-12 col-lg-12">
                    <div class="atras"> <a href="https://emiliomm.github.io">< Volver atrás </a></div>
                        <h1 class="intro"><span>Practica</span> <span>1-1</span> <span>:</span> <span>Dos</span> <span>muelles</span> <span>con</span> <span>el</span> <span>mismo</span> <span>extremo</span></h1>
                    </div>
                </div>
            </header>

            <!-- <div class="row grid-list-wrapper no-gutter-space" id="shots">
            	
            </div> -->

            <div class="row">
                    <div class="col-md-12 col-lg-12">
                    	<div class="cuerpo">

                        	

                            <script src="processing.js"></script>
                            <script type="text/processing" data-processing-target="mycanvas">
                            float dt = 0.8;

final int EULER = 0;
final int EULER_SEMI = 1;


int modo = 0; //modo actual


// Extremos
Extremo[] vExtr = new Extremo[1]; //El vector antes tenia longitud 2, pero solo se usa un extremo
Extremo[] vFijos = new Extremo[2];
Muelle[] vMuelles = new Muelle[2];


//Archivo para almacenar los datos de la curva a representar
//PrintWrinter output;


void setup() {
  size(640, 360);
  // Create objects at starting location
  
  // Creación de los puntos fijos A y B
  
  vFijos[0] = new Extremo(width*0.5, (1.0/8.0)*height);
  vFijos[1] = new Extremo(width*0.5, (7.0/8.0)*height);
  
  
  // Creación del extremo común de los muelles
  
  vExtr[0] = new Extremo(0.5*width, 0.5*height);
  
  
  //Creación de los muelles
  
  vMuelles[0] = new Muelle(vFijos[0], vExtr[0],0);
  vMuelles[1] = new Muelle(vFijos[1], vExtr[0],0);
  
  //Creacion del fichero
  //output = createWriter("Positions.txt");
}

void draw() {
  background(255);
  for (int i = 0; i < vMuelles.length; i++) {
    vMuelles[i].update();
    vMuelles[i].display();
    //Escribimos el fichero
    //if (i==0)
    //  output.prinln(vMuelles[0].len-vMuelles[0].len_reposo);
  }
  
  if (keyPressed) {
    if (key == '0')
    {
      modo = 0;
    }
    if (key == '1')
    {
      modo = 1;
    }
  }
  
  fill(0);
  text("Modo actual: " + modo, 50, 300);
  text("Pulsa la tecla 0 para la simulación se realice con Euler Exp", 50, 320);
  text("Pulsa la tecla 1 para la simulación se realice con Euler Semi", 50, 330);
  
  for (int i = 0; i < vExtr.length; i++) {
    vExtr[i].update(modo);
    vExtr[i].display();
    vExtr[i].drag(mouseX, mouseY);
  }
}

void mousePressed() {
  for (Extremo b : vExtr) {
    b.clicked(mouseX, mouseY);
  }
}

void mouseReleased() {
  for (Extremo b : vExtr) {
    b.stopDragging();
  }
}
void keyPressed() {
  //if(key == 'f' || key == 'F'){
  //  output.flush();
  //  output.close();
  //}
}

class Muelle {
  PVector longActual = new PVector();
  float longReposo;
  float k = 0.4;

  Extremo a;
  Extremo b;

  Muelle(Extremo A, Extremo B, int lReposo) {
    a = A;
    b = B;

    //lReposo
    longReposo = 5;
  }

  void update() {
    longActual = PVector.sub(b.location, a.location);
    float modLongActual = longActual.mag();
    longActual.normalize();
    
    PVector fMuelle1 = new PVector(0, 0);
    PVector fk1 = PVector.mult(longActual, k * (modLongActual - longReposo));
    PVector fk1_amort = PVector.mult(a.velocity, a.damping);
    fMuelle1 = PVector.sub(fk1, fk1_amort); //FUERZA k amortiguada = ks*(l_actual − l_reposo) − kd * vmuelle
    a.applyForce(fMuelle1);
    
    PVector fMuelle2 = new PVector(0, 0);
    PVector fk2 = PVector.mult(longActual, (-k) * (modLongActual - longReposo));
    PVector fk2_amort = PVector.mult(b.velocity, b.damping);
    fMuelle2 = PVector.sub(fk2, fk2_amort); //FUERZA k amortiguada = ks*(l_actual − l_reposo) − kd * vmuelle
    b.applyForce(fMuelle2);
  }

  void display() {
    strokeWeight(2);
    stroke(0);
    line(a.location.x, a.location.y, b.location.x, b.location.y);
  }
}

class Extremo {
  PVector location;
  PVector velocity;
  PVector acceleration;
  
  float masa = 10;

  PVector grav;

  PVector dragOffset;
  boolean dragging = false;
  float damping; //amort

  // Constructor
  Extremo(float x, float y) {
    location = new PVector(x, y);
    velocity = new PVector();
    acceleration = new PVector();
    
    grav = new PVector(0, 9.8);
    
    dragOffset = new PVector();
    
    //Tiene amortiguación
    damping = 0.4;
  }

  //Utilizamos Euler-semi
  void update(int mode) {
    applyForce(grav); //aplicamos la gravedad

    switch(mode){
    case EULER:
      location.add(velocity.mult(dt));
      velocity.add(acceleration.mult(dt));
      break;
    case EULER_SEMI:
      velocity.add(acceleration.mult(dt));
      location.add(velocity.mult(dt));
      break;
    }
    acceleration = new PVector(0, 0);
  }


  void applyForce(PVector force) {
    PVector f = force.get();
    f.div(masa);
    acceleration.add(f);
  }

  void display() {
    stroke(0);
    strokeWeight(1);
    fill(255, 0, 0);

    if (dragging) {
      fill(50);
    }
    
    ellipse(location.x, location.y, masa * 2, masa * 2);
  }

  void clicked(int mx, int my) {
    float d = dist(mx, my, location.x, location.y);
    
    if (d < masa) {
      dragging = true;
      dragOffset.x = location.x-mx;
      dragOffset.y = location.y-my;
    }
  }

  void stopDragging() {
    dragging = false;
  }

  void drag(int mx, int my) {
    if (dragging) {
      location.x = mx + dragOffset.x;
      location.y = my + dragOffset.y;
    }
  }
}
                            </script>
                            <canvas class="processingCanvas"></canvas>

                            <div class="instrucciones">
                                Puedes cambiar el modo en el que muelle simula su posición.<br>
                                Pulsa 0 para simular con Euler.<br>
                                Pulsa 1 para simular con Euler-semi.
                            </div>

						</div>
                    </div>
            </div>

         </div>
    </div>

    <footer>
        <div class="container">
            <nav class="nav-footer">
                <ul>
                    <!-- <li>
                        <a href="#">About</a>
                    </li>

                    <li>
                        <a href="#">Blog</a>
                    </li>

                    <li>
                        <a href="#">Resume</a>
                    </li>

                    <li>
                        <a href="#">Contact</a>
                    </li> -->
                </ul>

                                  <ul>
                                      <li><a href="https://www.facebook.com/emilio.montejanomora"> <i class="fa fa-facebook"></i> </a></li>
                                      <li><a href="https://github.com/emiliomm/"> <i class="fa fa-github"></i> </a> </li>
                                  </ul>

                <p class="credits text-center">2016 </p>
            </nav>
        </div>

    </footer>
</body>
</html>